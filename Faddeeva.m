(* ::Package:: *)

BeginPackage["Faddeeva`"];


Faddeeva::usage =
	"Faddeeva[z] returns the value of the Faddeeva function for complex z.";
ErfcxRe::usage = "ErfcxRe[x] returns the scaled complementary error function Exp[x^2]Erfc[x] for real x.";
ErfcxIm::usage = "ErfcxIm[x] returns the scaled imaginary error function Exp[-x^2]Erfi[x] for real x.";


Unprotect[Evaluate[$Context<>"*"]];


Begin["`Private`"];


lookupErfcxRe =
{{0.013945482342263811`,0.1701705729245929`,0.18509934724304314`,0.19362547642003836`,0.19400573893166181`,0.18525207528514506`,0.16751755062657844`,0.1420906102840906`},
{0.01742451418809302`,0.17781325705180817`,0.19719772146925557`,0.20991455602130893`,0.21357684277374037`,0.20659376712330013`,0.18871722317419423`,0.16114941992930593`},
{0.021061372579845156`,0.18596006680790889`,0.21032217063123682`,0.22785819124190587`,0.2354147876809503`,0.23064579942417388`,0.21276353072402968`,0.18280761360214004`},
{0.02486656406807038`,0.1946541054200841`,0.22457763232052377`,0.24764904099109872`,0.25980843328144354`,0.2577724234619507`,0.2400436201314013`,0.20740270567009922`},
{0.028851500831578874`,0.20394291435237002`,0.2400813270184699`,0.2695043938138398`,0.2870854836808052`,0.28838727282369936`,0.27099441271975355`,0.2353085462004048`},
{0.033028594558747175`,0.2138789954603065`,0.25696433317362866`,0.29366948114697355`,0.3176177346139293`,0.32295964604074456`,0.3061078129782284`,0.266936981827834`},
{0.03741136142931462`,0.22452040029763226`,0.2753733741828938`,0.3204212363204259`,0.35182698054848816`,0.36202142688244304`,0.3459361110154871`,0.3027389319982913`},
{0.04201453962814578`,0.23593139560769472`,0.2954728456564172`,0.35007255467772636`,0.39019164649409627`,0.406174660149049`,0.39109748260681926`,0.3432046713626528`},
{0.046854221014893734`,0.24818321523598533`,0.3174471148253758`,0.3829771154253154`,0.43325421041776`,0.4560997874302669`,0.4422814593547715`,0.3888630806046416`},
{0.051947998791466186`,0.26135491004941563`,0.3415031277464267`,0.41953483108825135`,0.481629481779992`,0.5125645299371139`,0.5002542064347788`,0.4402796035924693`},
{0.05731513325570794`,0.27553430895523784`,0.3678733640651373`,0.46019799561202707`,0.5360137993670648`,0.576433383760464`,0.5658634073905344`,0.4980526313816076`},
{0.06297673800805423`,0.29081910579024384`,0.3968191835114129`,0.5054782070319975`,0.5971952068481587`,0.6486776664723174`,0.6400425156925501`,0.56280802658602`},
{0.06895598929160814`,0.307318088710719`,0.4286346129899779`,0.5559541450218362`,0.6660646568559303`,0.7303860227517855`,0.7238140929722902`,0.6351915084956592`},
{0.07527836149890006`,0.32515253076606887`,0.46365062806149476`,0.6122802872806812`,0.7436282833994127`,0.8227752608063142`,0.8182919161790606`,0.7158586434950501`},
{0.08197189227444174`,0.34445776259277755`,0.5022399877319844`,0.6751966513381827`,0.8310207676192362`,0.9272013511795074`,0.92468150302077`,0.8054622298632789`},
{0.08906748108518331`,0.36538495062661674`,0.5448226867086643`,0.7455396496265918`,0.929519802894686`,1.045170375840733`,1.044278679958554`,0.9046369331351952`},
{0.09659922562530682`,0.38810310690278244`,0.5918720945478088`,0.824254145240509`,1.0405616418115566`,1.1783491693669574`,1.1784658029759345`,1.0139811188886785`},
{0.10460480097164904`,0.41280135939479373`,0.6439218563019042`,0.9124067933102891`,1.1657576793331115`,1.3285753470768265`,1.328705241616662`,1.13403594351456`},
{0.11312588701557699`,0.4396915149274745`,0.7015736342340102`,1.0112007479800371`,1.3069119936894347`,1.497866369068037`,1.4965297544523362`,1.2652618977617474`},
{0.12220865037029964`,0.4690109499752481`,0.7655057747493677`,1.1219918072398622`,1.4660397292271008`,1.6884272464914605`,1.6835294217852157`,1.408013148125949`},
{0.13190428769304177`,0.5010258681056488`,0.8364829887191867`,1.2463060569753248`,1.6453861641945668`,1.9026564595862494`,1.8913348608236873`,1.5625101809400128`},
{0.14226963817243868`,0.536034966423212`,0.9153671366413988`,1.3858590612721278`,1.847446261892809`,2.1431496286740477`,2.121596530554953`,1.7288114150039662`},
{0.1533678738155341`,0.5743735570763259`,1.0031292123845528`,1.5425766280262585`,2.0749844567789326`,2.412700462160525`,2.3759600375822547`,1.9067846010766833`},
{0.16526927712770456`,0.6164181936659957`,1.1008626203696215`,1.7186171571234938`,2.331054379219806`,2.714298502168289`,2.6560374783771024`,2.096078960109429`},
{0.17805211681356437`,0.6625918561885225`,1.2097978407309973`,1.9163955528415244`,2.619018175140723`,3.0511232009583615`,2.963374994337422`,2.2960991163236373`},
{0.19180363323715754`,0.7133697518923601`,1.33131857503528`,2.1386086527943884`,2.942565031488228`,3.4265338915275634`,3.2994168689499763`,2.505981946562694`},
{0.2066211465639358`,0.7692857930625477`,1.4669794613077898`,2.388262092924971`,3.3057284770566424`,3.844055264784591`,3.6654666552099`,2.724577485899094`},
{0.22261330176207494`,0.8309398161854482`,1.6185254412242387`,2.668698492149382`,3.712901992715326`,4.3073580338135145`,4.062645979289858`,2.9504349957834015`},
{0.2399014659618727`,0.8990056101059873`,1.787912854198981`,2.9836268018115284`,4.168852437306389`,4.820234552360913`,4.491851815751501`,3.1817952125839155`},
{0.25862129505278997`,0.974239823577069`,1.977332322609151`,3.3371526248091548`,4.678730777246045`,5.386569258347024`,4.953713162707845`,3.4165896520005616`},
{0.27892448782974216`,1.0574918249197776`,2.189233479448907`,3.7338092679318295`,5.248079600748685`,6.010303931515344`,5.448548154983952`,3.6524476527414107`},
{0.3009807474731634`,1.1497145882643955`,2.4263515742762993`,4.17858924955105`,5.882836902911578`,6.695397884080491`,5.976322733006004`,3.88671160840816`},
{0.32497997164880715`,1.2519766819270148`,2.6917359754228785`,4.676975944358307`,6.589335646602025`,7.445783340484079`,6.536612029628188`,4.116460569865119`},
{0.3511346940289052`,1.3654754347977371`,2.988780566173063`,5.234975008453461`,7.374298636708508`,8.265316402657033`,7.128565642705215`,4.338542113658967`},
{0.37968280154998346`,1.4915513560822538`,3.321256010143077`,5.85914519286238`,8.244828291918687`,9.157724135713288`,7.750877926064402`,4.549612078782527`},
{0.4108905532163624`,1.6317038822646146`,3.693343836621486`,6.556628122614259`,9.20839095834825`,10.126548440853398`,8.40176435567679`,4.746181488102701`},
{0.44505592771258995`,1.7876085226712153`,4.109672270463383`,7.335176592887165`,10.272795482156722`,11.175087502648637`,9.078944913241466`,4.924669705494049`},
{0.4825123284818642`,1.961135471453111`,4.575353703607092`,8.203180914395153`,11.446165842377562`,12.30633570236404`,9.779635279844724`,5.081462647251208`},
{0.5236326762389015`,2.1543697491195037`,5.0960236768087706`,9.169692827975185`,12.736907738769627`,13.52292297366913`,10.500546453165528`,5.212974676859393`},
{0.5688339200919439`,2.3696329309204316`,5.677881211214764`,10.244446503912405`,14.153669130420383`,14.827054638803222`,11.237893199456598`,5.315712673388106`},
{0.6185819995265389`,2.6095065123808387`,6.327730300397637`,11.437876145410282`,15.70529482667697`,16.220452799681755`,11.987411533708219`,5.386340680572936`},
{0.6733972904301906`,2.876856954140641`,7.053022344976218`,12.761129728058162`,17.40077534014189`,17.70430036815608`,12.744385195961213`,5.42174351811022`},
{0.7338605690892152`,3.1748624389860036`,7.86189928444111`,14.226078428250387`,19.249190319246704`,19.279188802240952`,13.503680866725082`,5.419087768039504`},
{0.8006195286451636`,3.5070413636164877`,8.763237154831032`,15.845321323129482`,21.259646982615653`,20.945070571125`,14.259791647633964`,5.3758786339778615`},
{0.8743958828372582`,3.8772825763519037`,9.766689776953545`,17.632184982410003`,23.441214076455324`,22.701217302598874`,15.006888131964816`,5.290011303829891`},
{0.955993091960291`,4.289877359732348`,10.882732258390751`,19.600717617837468`,25.802851967143187`,24.54618447439705`,15.738876209668893`,5.159815620100158`}};


(*
	For x < approx -26.6 overflow will occur. $MaxMachineNumber is returned.

	For x < -6.1 the function is within machine precision of 2 Exp[x^2], this is returned.

	For x > 5e7 the function is within machine precision of x^-1 / Pi^(1/2), this is returned.

	For x > 46 a continued fraction approximation works well.

	For 0 < x < 46:
	The rescaled complementary error function Exp[x^2]Erfc[x] is reparametrized as y \[Equal] 4/(4+x), values of y run from 0.08 (x\[Equal]46) to 1, (x\[Equal]0), this is subdivided into
	runs of 0.02, each run is fitted to a 7th degree polynomial for arguments between -0.01 and 0.01, with matching of up to 3rd order derivatives at the end points of 
	adjacent runs. The number of the run is given by Floor[50*y] - 3. The argument passed to the polynomial should be y - 0.07 - 0.02*n where n is the number of the
	run.

	For x \[Equal] 0. the function is 1.

	For x < 0 ErfcxRe[x] \[Equal] 2 Exp[x^2] - ErfcxRe[-x].
*)
ErfcxRe =
	With[{lookupErfcxRe = lookupErfcxRe}, Compile[
		{{x, _Real}},
Block[{res = 1., xAbs = Abs[x]},
	If[x < -26.6, Return[1.7976931348623157`*^308]];
	If[x < -6.1, Return[2. Exp[x*x]]];
	If[x >= 5.*^7, Return[Divide[0.5641895835477563`,x]]];
	If[x > 45.9, With[{x2=x*x},Return[Divide[0.5641895835477563` x (558+x2 (740+x2 (216+16 x2))), 105+x2 (840+x2 (840+x2 (224+16 x2)))]]]];
	If[x == 0., Return[res]];
	res = With[
			{lookupTable = lookupErfcxRe,
			y = Divide[4, 4 + xAbs]},
			With[{n = Subtract[Floor[50 y], 3]},
				With[{yOff = y - 0.07 - 0.02 n}, Fold[# yOff + #2 &, Reverse[lookupTable[[n]] ]]]
			]
		];
		If[x < 0., Return[Subtract[2 Exp[x*x], res]]];
		res
		]
		,
		RuntimeAttributes->{Listable}, RuntimeOptions->"Speed", Parallelization->True, CompilationTarget->"C"]];


lookupErfcxIm =
{{0.014471159831187684, 0.5940795794052425, 0.6334038704099504, 1.005984281592316, 1.804587392050337, 3.6943132697996597, 8.255087352850575, 19.989837496545398},
 {0.020476320420324583, 0.607056860257931, 0.6647043754840488, 1.082034390402302, 2.0024150908234892, 4.234339601893868, 9.812348362006555, 24.6917234003564},
 {0.026614461952488972, 0.6206837855246462, 0.6984107244045278, 1.1665704828004728, 2.2297531960743444, 4.878473301803216, 11.744968743349114, 30.781212396224802},
 {0.03289233024809354, 0.6350111413595012, 0.734796303299049, 1.2608850961870888, 2.4924217773186554, 5.652436934420148, 14.166827605084322, 38.765850616261346},
 {0.039317207681134274, 0.6500955940387506, 0.7741770418695104, 1.3665317577338616, 2.7977169788085106, 6.589978562101967, 17.234794800218747, 49.38184436648687},
 {0.045896976511367656, 0.6660006254622193, 0.8169202159337817, 1.4853929976707538, 3.1548855190431238, 7.736000106772181, 21.168816021975097, 63.72063422992987},
 {0.05264019252484885, 0.682797667176934, 0.863455609641099, 1.619770920185636, 3.575790652170397, 9.151202279744195, 26.283597157688813, 83.44173568426241},
 {0.05955617122865661, 0.7005674877329776, 0.9142898460640383, 1.7725097718136562, 4.075866233764704, 10.919160608644523, 33.04020087728645, 111.14475484820618},
 {0.06665508948510798, 0.7194019076254248, 0.9700250466079186, 1.9471649218876625, 4.6755166831470705, 13.157437253068249, 42.133337398090404, 151.05098623892113},
 {0.07394810634551882, 0.7394059443313852, 1.0313835255456214, 2.1482409604291925, 5.402230727295111, 16.035684278274775, 54.64617888333785, 210.32877895002244},
 {0.08144750806500241, 0.7607005321298512, 1.0992411029730624, 2.3815360589695684, 6.293886361210594, 19.806530101992433, 72.34222446331576, 301.8845355414689},
 {0.08916688402758179, 0.7834260264487733, 1.1746730905575746, 2.654656352051411, 7.404153878335098, 24.861601827369952, 98.26499299925736, 450.9963702219053},
 {0.09712134288803059, 0.8077468070641451, 1.259019616100059, 2.9778171400733906, 8.811886435895426, 31.84284313366671, 138.16042316366534, 714.8352942816234},
 {0.10532778218602937, 0.8338574722812747, 1.353981991560593, 3.3651677003132847, 10.639104131839089, 41.900896125722234, 204.6175051869849, 1248.9010158420494},
 {0.11380523107426312, 0.8619914457573846, 1.4617729749373898, 3.8372035298674487, 13.090968986934062, 57.38885587170338, 328.16264519426164, 2418.8786504217474},
 {0.12257529703446454, 0.8924335142005748, 1.5853721904746731, 4.425724296468646, 16.549693562650283, 83.30850633625856, 564.1663701863358, 4402.618664271275},
 {0.1316627695565719, 0.9255394096359716, 1.729001054478033, 5.183933075981983, 21.72816996725011, 127.48959129022171, 922.9629215129429, 5364.587826697025},
 {0.14109647869807973, 0.9617684883714281, 1.8989801827477186, 6.200789241170435, 29.659405685741387, 192.47292391085108, 1174.3570292468798, 464.68351215847355},
 {0.15091057940557528, 1.001737293440326, 2.104899299533354, 7.602773143742055, 40.98364384083959, 256.5878922565542, 764.0465046802361, -13507.672675631142},
 {0.16114648116024496, 1.0462932316326072, 2.360221369851909, 9.508414740366222, 54.362001966648364, 262.7533730955384, -810.1031658396394, -31116.46522658398},
 {0.1718555127968029, 1.0965800593509336, 2.6805290665932184, 11.917920691597187, 65.10444199088968, 140.9872469202976, -3368.874170006959, -39481.44241565776},
 {0.1831019455980527, 1.1540311875184088, 3.077951592051728, 14.582056010051193, 65.74657404106728, -140.83705512876134, -5874.91168792463, -28893.417155377196},
 {0.1949652719153096, 1.2202170628870626, 3.552515267335413, 16.94454943105487, 49.041927346380206, -538.9241737213597, -7005.032271361238, -1532.2059458431527},
 {0.20754006813952458, 1.2965157544989743, 4.083839873602675, 18.2281866360466, 11.757879799592994, -942.1627802725284, -5985.106201100398, 30158.920196854335},
 {0.22093185554838263, 1.3836575630046946, 4.6274893435193105, 17.648462220122127, -43.08823261741043, -1221.641506760874, -3015.8696764729734, 52312.1314551867},
 {0.23524827304059662, 1.48126701524105, 5.11853354688618, 14.661813724770871, -106.78847937942069, -1286.5454498535053, 924.2747125946767, 57398.01845387317},
 {0.25058626331821215, 1.5875457030325566, 5.4817074466085325, 9.14200931617392, -167.76626532480097, -1115.2079858341292, 4628.298793085042, 46270.350882373474},
 {0.26701724900291957, 1.6991987223926082, 5.644943759540791, 1.42403416979454, -215.09479133356132, -752.3979529249563, 7168.467079628665, 25398.107070978123},
 {0.2845729358626416, 1.811631277852779, 5.552208115646259, -7.780984155361447, -241.23259185863043, -283.43945949367816, 8139.691546862273, 2606.5422965995585},
 {0.303234255956249, 1.9193669358115637, 5.172427098669984, -17.55099330590214, -243.24549607894184, 197.71996957680045, 7633.7787021431395, -16080.99397125713},
 {0.3229252118152117, 2.016591545399846, 4.503035764399489, -26.936712197813424, -222.56810092634882, 613.4600436638049, 6060.0764874929255, -27666.3078998606},
 {0.34351233557912203, 2.0977150871142367, 3.568377767213963, -35.11476761548561, -183.8174990672654, 915.1815792160224, 3937.8268416527553, -31881.520027450755},
 {0.3648094664214174, 2.157860840686176, 2.414319752897574, -41.48468971057699, -133.26684780608892, 1084.7349543989487, 1738.2523878959266, -30189.54734468843},
 {0.3865867993569171, 2.1932238316576753, 1.1008644868420485, -45.70621961756352, -77.44794663945227, 1128.5867180877535, -198.9805611035938, -24737.811551006842},
 {0.4085827558380509, 2.201275603369692, -0.30558550095736975, -47.687868387153635, -22.135723116092247, 1069.0224833790282, -1685.1377466604704, -17600.102431352763},
 {0.43051714914003325, 2.1808213099002143, -1.739101084894458, -47.543791645719075, 28.222397659487072, 935.552099529876, -2661.3975655649324, -10376.920028282353},
 {0.45210428135556857, 2.131934151276956, -3.139545592131878, -45.53588872010611, 70.69069683350044, 758.218341518621, -3160.4896924063655, -4082.7209578554243},
 {0.4730649119500322, 2.0558012239492762, -4.456107265523161, -42.01442820976931, 103.75484451466163, 563.3165716532482, -3267.152513977682, 792.8711253141445},
 {0.49313638965718576, 1.9545159822955132, -5.6491417048630135, -37.36580206571129, 127.074033560173, 371.2973898304367, -3085.969591192585, 4148.648563472023},
 {0.5120805743341533, 1.830848447080243, -6.690612091022091, -31.971697410603394, 141.1715404950482, 196.29838196163556, -2719.3621175501976, 6125.731620310024},
 {0.5296894545860729, 1.6880176089023786, -7.563491913249441, -26.18072438051066, 147.12989013821706, 46.701072270848336, -2255.0781429857716, 6985.587342790975},
 {0.5457885745433021, 1.5294831039176342, -8.2604922365275, -20.29147131658773, 146.32859914990055, -73.79614593805331, -1761.0018143319983, 7023.3701246456885},
 {0.5602385191029884, 1.3587664347999602, -8.78242664584604, -14.544902138740344, 140.24056213972963, -164.9536820243422, -1284.8198384474804, 6514.928288745305},
 {0.5729347805745617, 1.179306420207888, -9.136458092384597, -9.123684450652522, 130.28849973757065, -228.8397802914979, -856.4257425521353, 5690.245887597039},
 {0.583806354484083, 0.9943493906168573, -9.334400616729443, -4.1561651559882975, 117.75456126909945, -268.86692878091986, -491.50543714072734, 4724.972392720897},
 {0.5928134023776995, 0.8068718413875912, -9.391185496167283, 0.2769275604051942, 103.73252086527141, -289.05334804844324, -195.30115282858338, 3742.784318823513},
 {0.5999442874311469, 0.6195315957654292, -9.323550306918005, 4.1345344827486015, 89.11138314828709, -293.50121647963795, 34.00453906557756, 2823.172943001552},
 {0.6052122447182023, 0.4346427602469024, -9.14897158839979, 7.407116794799213, 74.58029312640899, -286.05996025927294, 202.52990412389624, 2011.0813403470722},
 {0.6086518996979142, 0.2541696169775422, -8.884836045067416, 10.108988826229632, 60.64648233652712, -270.13473691428135, 318.6093913493081, 1326.2918884406465},
 {0.6103158010349944, 0.07973487211171566, -8.547829376192114, 12.271521704160381, 47.65998497892307, -248.6009832168831, 391.32436049603433, 771.5185635111874},
 {0.6102710904788001, -0.08736180901612543, -8.153513515596863, 13.937394473538328, 35.84069486408093, -223.7911424465008, 429.54274136720886, 338.83486965401516},
 {0.6085963948921757, -0.2461184278192873, -7.716060101759668, 15.155923731888665, 25.304858861820282, -197.5265643700866, 441.3502989845459, 14.457702232752112},
 {0.6053789942648616, -0.39580124482791806, -7.2481085573593615, 15.979411330427899, 16.08927927116301, -171.1744215431621, 433.7652047704063, -217.90009947056413},
 {0.6007122945790417, -0.5359135355233302, -6.760719821542175, 16.460398659923737, 8.172351031025462, -145.71547780500092, 412.64544291813064, -374.826608502254},
 {0.5946936152011275, -0.6661641638120223, -6.263400518417578, 16.649693530667985, 1.491642165830035, -121.81337314614765, 382.7185657118847, -471.8757640587157},
 {0.5874222863177541, -0.7864371639211863, -5.76417645660349, 16.595032014984692, -4.041903422258073, -99.87974563522171, 347.681905418762, -522.8538290957468},
 {0.5789980420003302, -0.8967631401123796, -5.2696983866026965, 16.34024551082269, -8.532847256463212, -80.13213533832334, 310.3369918569924, -539.527815855159},
 {0.5695196879693124, -0.9972929897614983, -4.785366633378209, 15.924817424920537, -12.092823097456874, -62.64340131634941, 272.7342175488715, -531.6036205033897},
 {0.559084019300639, -1.0882742207365381, -4.315464440982054, 15.38373065846758, -14.834358142047682, -47.38252773877017, 236.31295343007258, -506.8632356837249},
 {0.5477849615292566, -1.1700299586642682, -3.86329257268549, 14.74752418810146, -16.866529862061597, -34.24737315405228, 202.02883242882947, -471.3842686714713},
 {0.535712908316828, -1.242940613415216, -3.431299916652661, 14.042493090774753, -18.292077371434406, -23.090270213783054, 170.4643398241219, -429.79101830261834},
 {0.5229542296204841, -1.3074280873555264, -3.0212065976261573, 13.29098063774635, -19.205635735254315, -13.737521245412456, 141.92169766735555, -385.5054747570717},
 {0.5095909257757787, -1.3639423520623717, -2.6341174479258944, 12.511723291113872, -19.6928144197265, -6.00383864979084, 116.4987460065489, -340.9800740643108},
 {0.49570040481823147, -1.4129501879522879, -2.2706247091277802, 11.720219559293339, -19.8298919118358, 0.29729489402591397, 94.14945577188293, -297.9031470409146},
 {0.4813553625093522, -1.4549258665480471, -1.930899579800631, 10.929101847266395, -19.683944563723756, 5.346484418421497, 74.73112141872852, -257.37388392027634},
 {0.4666237467551142, -1.4903435529905695, -1.614772749745095, 10.148496895091618, -19.313267662194367, 9.313763854846353, 58.040367983030094, -220.04721820784005},
 {0.4515687903016825, -1.5196712130006762, -1.3218044152047796, 9.386365385600147, -18.767980302362915, 12.355811187669303, 43.84000177141078, -186.2510350688909},
 {0.43624909769330883, -1.543365820806191, -1.0513444928328162, 8.648815069487517, -18.090733154837103, 14.614544307245923, 31.878527465952292, -156.07906572629471},
 {0.42071877443548467, -1.5618696803010543, -0.8025838758707682, 7.940384534427796, -17.317460265826114, 16.216706332548238, 21.90390596915329, -129.46312431692309},
 {0.4050275880971083, -1.5756076892174586, -0.5745976305654792, 7.264296738237134, -16.478133357520523, 17.274135967292526, 13.672873209056299, -106.22824486950856},
 {0.3892211526973144, -1.584985394164841, -0.36638103518279513, 6.622682808155445, -15.597490460261307, 17.88449036614792, 6.956901216882652, -86.13396356352506},
 {0.373341129154603, -1.5903877021844628, -0.17687933418372212, 6.016777523039487, -14.69572082311078, 18.13224629807421, 1.54566965722348, -68.90458203908774},
 {0.35742543583374214, -1.592178131430559, -0.005012028410530657, 5.447088459574528, -13.789095554087371, 18.08985180067369, -2.751267322763826, -54.25081370208472},
 {0.34150846431979615, -1.590698499375476, 0.15030754245185324, 4.913541090631833, -12.89053888547236, 17.818936832591945, -6.104087455633584, -41.88479888904989},
 {0.3256212964913634, -1.5862689613589238, 0.29015663974109246, 4.41560224654262, -12.010138803858949, 17.371519391660673, -8.663174044686683, -31.530098592406134},
 {0.3097919197707839, -1.5791883252841075, 0.41559097511280585, 3.9523843445104156, -11.155598406385561, 16.791164751871694, -10.560152056185991, -22.92794960731076},
 {0.29404543811214456, -1.569734579807256, 0.527635427328969, 3.522732700242467, -10.332631047442543, 16.114071254710396, -11.909261551292657, -15.840788089144667},
 {0.2784042768625366, -1.5581655835250376, 0.6272771519521521, 3.125298090904995, -9.545303364350817, 15.370067629367425, -12.808905661469725, -10.053820831930054},
 {0.262888380111638, -1.5447198715223802, 0.7154606718510096, 2.758596562934152, -8.79633080350895, 14.58351506962623, -13.343258181507002, -5.375239081772732},
 {0.2475153995418103, -1.5296175433058046, 0.7930845934037914, 2.4210582887002583, -8.087330454457195, 13.774113039403574, -13.583852148991648, -1.6355225049564972},
 {0.23230087411688913, -1.513061202727683, 0.8609996445227037, 2.11106708411879, -7.419035947568523, 12.957611633955938, -13.59109790014584, 1.3138348967599631},
 {0.2172584002129734, -1.4952369261196008, 0.9200077761666415, 1.8269920128188628, -6.791478963403465, 12.146435777748646, -13.415699038452665, 3.6019351258521355},
 {0.2023997920078819, -1.4763152396098784, 0.97086210910637, 1.5672123263896833, -6.204141598316872, 11.350227972329419, -13.09994915682623, 5.340250064722364},
 {0.187735232115581, -1.456452090606808, 1.0142675427144465, 1.330136827440669, -5.6560834751509095, 10.576317009616266, -12.678902328702543, 6.624438553238588},
 {0.1732734125847965, -1.435789801782868, 1.0508818728959015, 1.114218594172596, -5.146047110517411, 9.830120258847986, -12.181417369431164, 7.536125561749727},
 {0.15902166648328672, -1.414457998684924, 1.0813172924056385, 0.9179658722783387, -4.672544672381895, 9.115486984656942, -11.63108048272091, 8.144591329652705},
 {0.14498609036610283, -1.392574504400915, 1.1061421691666131, 0.7399498219912937, -4.233928897375078, 8.43498978169335, -11.04701378011382, 8.50833941477607},
 {0.1311716579820805, -1.3702461966056365, 1.1258830172454166, 0.578809704248144, -3.8284505951899854, 7.790170707019291, -10.444578779561654, 8.676527648320254},
 {0.11758232561160627, -1.3475698238492828, 1.1410265912688784, 0.43325599923234137, -3.454304852500281, 7.1817481187374455, -9.835984720180818, 8.69025649342606},
 {0.10422112945361674, -1.3246327791969263, 1.152022048654442, 0.30207187187744017, -3.1096677633049685, 6.609789632473552, -9.230811650348102, 8.583716417685764},
 {0.09109027549354108, -1.3015138303223175, 1.1592831354209159, 0.18411333104650524, -2.7927252568665972, 6.0738560165240765, -8.636457960294075, 8.385200504027814},
 {0.07819122228877139, -1.2782838059460935, 1.1631903608517713, 0.07830837088684628, -2.5016953676357683, 5.573120281289354, -8.05852148815631, 8.117991324277035},
 {0.0655247571061474, -1.2550062391216623, 1.1640931341726917, -0.016344666840085634, -2.234845092138541, 5.106465690947712, -7.501122638098351, 7.801132604179572},
 {0.05309106583845361, -1.2317379683415537, 1.1623118429181376, -0.10077931288996321, -1.990502803689202, 4.672565941619915, -6.967177186985158, 7.450096807651578},
 {0.04088979711535274, -1.2085296977882856, 1.1581398580073894, -0.17586361230420813, -1.7670670447026346, 4.269950313125455, -6.458625674984908, 7.077359751379507},
 {0.0289201210095949, -1.185426518308287, 1.1518454549104433, -0.2424030571100769, -1.5630123859818108, 3.897056210834778, -5.9766255106020605, 6.692892941793383},
 {0.017180782722617877, -1.1624683908632334, 1.1436736438149542, -0.30114370452371947, -1.3768929303564037, 3.552271168359032, -5.52171119451768, 6.304583659465407},
 {0.0056701516155015135, -1.1396905943255125, 1.133847904541767, -0.35277539635663785, -1.2073439422724626, 3.233966078122174, -5.093927392494299, 5.918592011557103}};


(*
	For x > 5e7 the function is within machine precision of x^-1 / Pi^(1/2), this is returned.

	For x > 49 a continued fraction approximation works well.

	For 0 < x < 49:
	The rescaled complementary error function Exp[x^2]Erfc[x] is reparametrized as y \[Equal] 1/(1+x), values of y run from 0.02 (x\[Equal]49) to 1, (x\[Equal]0), this is subdivided into
	runs of 0.02, each run is fitted to a 7th degree polynomial for arguments between -0.01 and 0.01, with matching of up to 3rd order derivatives at the end points of 
	adjacent runs. The number of the run is given by Floor[50 y]. The argument passed to the polynomial should be y - 0.01 - 0.02*n where n is the number of the
	run.

	For x \[Equal] 0. the function is 0.

	For x < 0 ErfcxIm[x] \[Equal] - ErfcxIm[-x]. This is automatically handled in the rational approximations, otherwise Return value times Sign[x] works.
*)
ErfcxIm =
	With[{lookupErfcxIm = lookupErfcxIm}, Compile[
		{{x, _Real}},
Block[{res = 0., xAbs = Abs[x]},
	If[xAbs >= 5.*^7, Return[Divide[0.5641895835477563`,x]]];
	If[xAbs > 48.9, With[{x2=x*x},Return[Divide[0.5641895835477563` x (-558+x2 (740+x2 (-216+16 x2))), 105+x2 (-840+x2 (840+x2 (-224+16 x2)))]]]];
	If[x == 0., Return[res]];
	res = With[
			{lookupTable = lookupErfcxIm, y = Divide[1, 1 + xAbs]},
			With[{n = Subtract[Floor[100 y], 1]},
				With[{yOff = y - 0.015 - 0.01 n}, Fold[# yOff + #2 &, Reverse[lookupTable[[n]] ]]]
			]
		];
		res * Sign[x]
		]
		,
		RuntimeAttributes->{Listable}, RuntimeOptions->"Speed", Parallelization->True, CompilationTarget->"C"]];


uExp = Compile[{{z, _Complex}}, If[Re[z] > -705., Exp[z], 0.],
	CompilationTarget->"C", RuntimeAttributes->{Listable}, RuntimeOptions->"Speed", Parallelization->True]


Faddeeva =
	Block[{lookupEmA2N2 = Table[Reverse@#~Join~#&[Table[Exp[-n^2/16.] + 0. I,{n,106}]],{3}] // Developer`ToPackedArray,
		lookupAN = Delete[Table[n/4., {n,-106, 106}],{107}], lookupA2N2},
		lookupEmA2N2[[3]] *= I lookupAN;
		lookupA2N2 = lookupAN^2 + 0.I;
	With[{lookup = lookupEmA2N2//Developer`ToPackedArray, lAN = lookupAN//Developer`ToPackedArray, lA2N2 = lookupA2N2//Developer`ToPackedArray},
	Compile[
		{{z, _Complex}},With[{x = Re[z], y = Im[z]},With[{ere = Exp[y*y]Erfc[y], mxx = Minus[x*x], mxy = Minus[x*y]},
		If[z == 0. + 0. I, Return[1. + 0. I]];
		If[x == 0., Return[0. I + ere]];
		If[y == 0., Return[Exp[mxx] + I ErfcxIm[x]]];
		If[Abs[z] < 10.,
			Block[{sums = lookup, e2ANx = Exp[2 lAN x]},
				sums[[2]] *= e2ANx; sums[[3]] *= e2ANx;
				Return[Exp[mxx] *
					(ere Exp[2I mxy] + 0.07957747154594767` * 
						(2 I x Sinc[mxy] Exp[I mxy] +
							Total[Divide[{Minus[y Exp[2 I mxy]], y, 1.}.sums, lA2N2 + y*y]]))
				]
			]
		];
		With[{zz=z*z},0.5641895835477563` I Divide[z (-558+zz (740+zz (-216+16 zz))),105+zz (-840+zz (840+zz (-224+16 zz)))]]]],
		RuntimeAttributes->{Listable}, RuntimeOptions->"Speed", Parallelization->True, CompilationOptions->{"InlineExternalDefinitions" -> True}
	]
	]
	]


End[];


Protect[Evaluate[$Context<>"*"]];
EndPackage[]
